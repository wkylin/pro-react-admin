# Request.js æ¥å£åŠ å¯†åŠŸèƒ½è¯´æ˜

## ğŸ“¦ åŠŸèƒ½æ¦‚è¿°

ä¸º `request.js` æ·»åŠ äº†å®Œæ•´çš„æ¥å£æ•°æ®åŠ å¯†åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§åŠ å¯†æ–¹å¼ï¼Œå¯çµæ´»é…ç½®ï¼Œå¼€ç®±å³ç”¨ã€‚

## âœ¨ æ ¸å¿ƒç‰¹æ€§

### 1. å¤šç§åŠ å¯†æ¨¡å¼
- **AES å¯¹ç§°åŠ å¯†**: é«˜æ€§èƒ½ï¼Œé€‚åˆé«˜é¢‘è¯·æ±‚å’Œå¤§æ•°æ®é‡
- **RSA éå¯¹ç§°åŠ å¯†**: é«˜å®‰å…¨æ€§ï¼Œé€‚åˆæ•æ„Ÿä¿¡æ¯åŠ å¯†
- **æ··åˆåŠ å¯†æ¨¡å¼**: RSA åŠ å¯†å¯†é’¥ + AES åŠ å¯†æ•°æ®ï¼ˆâ­ æ¨èï¼‰

### 2. è‡ªåŠ¨åŒ–å¤„ç†
- âœ… è¯·æ±‚æ‹¦æˆªå™¨è‡ªåŠ¨åŠ å¯†è¯·æ±‚æ•°æ®
- âœ… å“åº”æ‹¦æˆªå™¨è‡ªåŠ¨è§£å¯†å“åº”æ•°æ®
- âœ… æ— éœ€ä¿®æ”¹ç°æœ‰ä¸šåŠ¡ä»£ç 

### 3. çµæ´»é…ç½®
- âœ… å…¨å±€é…ç½®ï¼Œä¸€æ¬¡é…ç½®å…¨å±€ç”Ÿæ•ˆ
- âœ… å•ä¸ªè¯·æ±‚å¯ç‹¬ç«‹æ§åˆ¶æ˜¯å¦åŠ å¯†
- âœ… æ”¯æŒåŠ¨æ€åˆ‡æ¢åŠ å¯†æ¨¡å¼
- âœ… æ”¯æŒä»æœåŠ¡å™¨è·å–åŠ å¯†é…ç½®

### 4. ä¼ä¸šçº§ç‰¹æ€§
- âœ… RSA åˆ†æ®µåŠ å¯†æ”¯æŒï¼ˆå¤„ç†é•¿æ–‡æœ¬é™åˆ¶ï¼‰
- âœ… å®Œæ•´çš„é”™è¯¯å¤„ç†æœºåˆ¶
- âœ… è¯¦ç»†çš„æ—¥å¿—è®°å½•
- âœ… ç¯å¢ƒå˜é‡é…ç½®æ”¯æŒ
- âœ… å¼€å‘/ç”Ÿäº§ç¯å¢ƒåˆ†ç¦»

## ğŸš€ å¿«é€Ÿå¼€å§‹

### æœ€ç®€å•çš„ç”¨æ³•ï¼ˆ3 è¡Œä»£ç ï¼‰

```javascript
import request from '@src/service/request'

// é…ç½®æ··åˆåŠ å¯†ï¼ˆæ¨èï¼‰
request.configureHybrid(PUBLIC_KEY, PRIVATE_KEY)

// ä¹‹åæ‰€æœ‰è¯·æ±‚è‡ªåŠ¨åŠ å¯†ï¼Œæ— éœ€ä»»ä½•ä¿®æ”¹ï¼
const data = await request.post('/api/login', { username, password })
```

### å®Œæ•´ç¤ºä¾‹

```javascript
// 1. åœ¨åº”ç”¨å…¥å£é…ç½®ï¼ˆsrc/index.tsxï¼‰
import request from '@src/service/request'

// æ–¹å¼ A: ä½¿ç”¨ AESï¼ˆé«˜æ€§èƒ½ï¼‰
request.configureAES('1234567890123456')

// æ–¹å¼ B: ä½¿ç”¨ RSAï¼ˆé«˜å®‰å…¨ï¼‰
request.configureRSA(RSA_PUBLIC_KEY, RSA_PRIVATE_KEY)

// æ–¹å¼ C: ä½¿ç”¨æ··åˆåŠ å¯†ï¼ˆæ¨èï¼‰
request.configureHybrid(RSA_PUBLIC_KEY, RSA_PRIVATE_KEY)

// 2. ä¸šåŠ¡ä»£ç æ— éœ€æ”¹åŠ¨
export const loginAPI = (credentials) => {
  return request.post('/api/login', credentials)  // è‡ªåŠ¨åŠ å¯†
}

// 3. å•ä¸ªè¯·æ±‚æ§åˆ¶ï¼ˆå¯é€‰ï¼‰
const publicData = await request.get('/api/public', {}, {
  encrypt: false  // æœ¬æ¬¡è¯·æ±‚ä¸åŠ å¯†
})
```

## ğŸ“– æ–‡æ¡£

- **[å¿«é€Ÿå¼€å§‹æŒ‡å—](./ENCRYPTION_QUICK_START.md)** - 5åˆ†é’Ÿå¿«é€Ÿé›†æˆ
- **[å®Œæ•´æ–‡æ¡£](./REQUEST_ENCRYPTION.md)** - è¯¦ç»†çš„ API æ–‡æ¡£å’Œä½¿ç”¨è¯´æ˜
- **[é…ç½®ç¤ºä¾‹](../src/config/encryption.example.js)** - å¯å¤åˆ¶çš„é…ç½®æ¨¡æ¿

## ğŸ¯ ä½¿ç”¨åœºæ™¯

### 1. ç™»å½•æ¥å£
```javascript
// è‡ªåŠ¨åŠ å¯†ç”¨æˆ·åå’Œå¯†ç 
request.post('/api/login', { username, password })
```

### 2. æ”¯ä»˜æ¥å£
```javascript
// è‡ªåŠ¨åŠ å¯†å¡å·ã€é‡‘é¢ç­‰æ•æ„Ÿä¿¡æ¯
request.post('/api/payment', { cardNumber, amount, cvv })
```

### 3. ä¸ªäººä¿¡æ¯
```javascript
// è‡ªåŠ¨åŠ å¯†èº«ä»½è¯å·ã€æ‰‹æœºå·ç­‰
request.put('/api/user/info', { idCard, phone, address })
```

## ğŸ§ª æµ‹è¯•å·¥å…·

é¡¹ç›®å†…ç½®äº†å¯è§†åŒ–æµ‹è¯•é¡µé¢ï¼š

1. å¯åŠ¨é¡¹ç›®
2. è®¿é—® `/crypto` è·¯ç”±
3. åˆ‡æ¢åˆ°"æ¥å£åŠ å¯†æµ‹è¯•"æ ‡ç­¾
4. å¯è§†åŒ–é…ç½®å’Œæµ‹è¯•åŠ å¯†åŠŸèƒ½

## ğŸ“Š API ä¸€è§ˆ

### é…ç½®æ–¹æ³•

```javascript
// AES åŠ å¯†
request.configureAES(key)

// RSA åŠ å¯†
request.configureRSA(publicKey, privateKey)

// æ··åˆåŠ å¯†
request.configureHybrid(publicKey, privateKey)

// å¯ç”¨/ç¦ç”¨
request.enableEncryption()
request.disableEncryption()

// é…ç½®è¯·æ±‚/å“åº”åŠ å¯†
request.setEncryptRequest(true/false)
request.setEncryptResponse(true/false)

// è·å–é…ç½®
request.getEncryptionConfig()
```

### è¯·æ±‚é…ç½®

```javascript
// å•ä¸ªè¯·æ±‚ç¦ç”¨åŠ å¯†
request.post('/api/data', payload, {
  encrypt: false
})

// åŠ å¯†å¤±è´¥æ—¶æŠ›å‡ºé”™è¯¯ï¼ˆé»˜è®¤ trueï¼‰
request.post('/api/data', payload, {
  throwOnEncryptError: false
})

// è§£å¯†å¤±è´¥æ—¶æŠ›å‡ºé”™è¯¯ï¼ˆé»˜è®¤ trueï¼‰
request.get('/api/data', {}, {
  throwOnDecryptError: false
})
```

## ğŸ” å®‰å…¨å»ºè®®

### âœ… æ¨èåšæ³•

1. **ä½¿ç”¨ç¯å¢ƒå˜é‡å­˜å‚¨å¯†é’¥**
   ```bash
   VITE_AES_KEY=your-secure-key
   VITE_RSA_PUBLIC_KEY=...
   ```

2. **ä»åç«¯è·å–å…¬é’¥**
   ```javascript
   const { publicKey } = await request.get('/api/crypto/public-key', {}, {
     encrypt: false
   })
   ```

3. **ä½¿ç”¨æ··åˆåŠ å¯†æ¨¡å¼**
   ```javascript
   request.configureHybrid(publicKey, privateKey)
   ```

4. **ç§é’¥ä¸è¦æš´éœ²ç»™å‰ç«¯**ï¼ˆä»…æœåŠ¡ç«¯æŒæœ‰ï¼‰

### âŒ é¿å…åšæ³•

- âŒ ç¡¬ç¼–ç å¯†é’¥
- âŒ å‰ç«¯æŒæœ‰ç§é’¥
- âŒ ä½¿ç”¨å¼±å¯†é’¥
- âŒ ç”Ÿäº§ç¯å¢ƒæš´éœ²é…ç½®

## ğŸ› ï¸ æŠ€æœ¯å®ç°

### æ ¸å¿ƒä¾èµ–
- **crypto-js**: AES åŠ å¯†åº“ï¼ˆå·²å®‰è£…ï¼‰
- **jsencrypt**: RSA åŠ å¯†åº“ï¼ˆå·²å®‰è£…ï¼‰

### æ¶æ„è®¾è®¡
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          Application (ä¸šåŠ¡ä»£ç )              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           Request.js (å°è£…å±‚)                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚    Request Interceptor (è¯·æ±‚æ‹¦æˆª)     â”‚   â”‚
â”‚  â”‚    - åŠ å¯†è¯·æ±‚æ•°æ®                      â”‚   â”‚
â”‚  â”‚    - æ·»åŠ åŠ å¯†æ ‡è¯†å¤´                    â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚   Response Interceptor (å“åº”æ‹¦æˆª)     â”‚   â”‚
â”‚  â”‚    - è§£å¯†å“åº”æ•°æ®                      â”‚   â”‚
â”‚  â”‚    - é”™è¯¯å¤„ç†                          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚        Encryption Handler (åŠ å¯†å¤„ç†å™¨)       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   AES    â”‚  â”‚   RSA    â”‚  â”‚  HYBRID  â”‚  â”‚
â”‚  â”‚  åŠ å¯†/è§£å¯†â”‚  â”‚  åŠ å¯†/è§£å¯†â”‚  â”‚  åŠ å¯†/è§£å¯†â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                  â”‚
                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚           HTTP Request (ç½‘ç»œè¯·æ±‚)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ•°æ®æµ

**è¯·æ±‚æµç¨‹:**
```
åŸå§‹æ•°æ® â†’ åŠ å¯†å¤„ç† â†’ æ·»åŠ å…ƒä¿¡æ¯ â†’ å‘é€è¯·æ±‚
{ user: "admin" } â†’ "U2FsdGVk..." â†’ { encrypted: "...", mode: "AES" } â†’ POST /api
```

**å“åº”æµç¨‹:**
```
æ¥æ”¶å“åº” â†’ è§£å¯†å¤„ç† â†’ è¿”å›æ•°æ®
â† { encrypted: "...", mode: "AES" } â† "U2FsdGVk..." â† { user: "admin" }
```

## ğŸ“ˆ æ€§èƒ½å½±å“

| åŠ å¯†æ–¹å¼ | æ€§èƒ½å¼€é”€ | é€‚ç”¨åœºæ™¯ |
|---------|---------|---------|
| AES | < 5% | é«˜é¢‘è¯·æ±‚ã€å¤§æ•°æ® |
| RSA | 10-30% | ä½é¢‘è¯·æ±‚ã€å°æ•°æ® |
| æ··åˆ | 5-10% | ç»¼åˆåœºæ™¯ï¼ˆæ¨èï¼‰|

## ğŸ”§ åç«¯å¯¹æ¥

### Node.js ç¤ºä¾‹

```javascript
const crypto = require('crypto')
const NodeRSA = require('node-rsa')

// è§£å¯†ä¸­é—´ä»¶
app.use((req, res, next) => {
  if (req.body && req.body.mode) {
    try {
      switch (req.body.mode) {
        case 'AES':
          req.body = decryptAES(req.body.encrypted, AES_KEY)
          break
        case 'RSA':
          req.body = decryptRSA(req.body.encrypted, PRIVATE_KEY)
          break
        case 'HYBRID':
          req.body = decryptHybrid(req.body.encrypted, req.body.key, PRIVATE_KEY)
          break
      }
      next()
    } catch (error) {
      res.status(400).json({ error: 'è§£å¯†å¤±è´¥' })
    }
  } else {
    next()
  }
})
```

è¯¦ç»†åç«¯å¯¹æ¥æ–‡æ¡£è¯·æŸ¥çœ‹ [å¿«é€Ÿå¼€å§‹æŒ‡å—](./ENCRYPTION_QUICK_START.md#åç«¯å¯¹æ¥)ã€‚

## ğŸ¨ å¯è§†åŒ–æµ‹è¯•

å†…ç½®çš„æµ‹è¯•é¡µé¢æä¾›ï¼š
- âœ… AES/RSA åŠ å¯†ç®—æ³•æ¼”ç¤º
- âœ… æ¥å£åŠ å¯†é…ç½®å’Œæµ‹è¯•
- âœ… å®æ—¶æŸ¥çœ‹åŠ å¯†ç»“æœ
- âœ… å®Œæ•´çš„ä½¿ç”¨è¯´æ˜

è®¿é—® `/crypto` è·¯ç”±å³å¯ä½¿ç”¨ã€‚

## ğŸ“ æ›´æ–°æ—¥å¿—

### v1.0.0 (2026-01-08)

**æ–°å¢åŠŸèƒ½:**
- âœ… AES å¯¹ç§°åŠ å¯†æ”¯æŒ
- âœ… RSA éå¯¹ç§°åŠ å¯†æ”¯æŒ
- âœ… æ··åˆåŠ å¯†æ¨¡å¼
- âœ… è¯·æ±‚è‡ªåŠ¨åŠ å¯†
- âœ… å“åº”è‡ªåŠ¨è§£å¯†
- âœ… RSA åˆ†æ®µåŠ å¯†
- âœ… å•ä¸ªè¯·æ±‚æ§åˆ¶
- âœ… å®Œæ•´é”™è¯¯å¤„ç†
- âœ… è¯¦ç»†æ—¥å¿—è®°å½•
- âœ… é…ç½®ç¤ºä¾‹å’Œæ–‡æ¡£
- âœ… å¯è§†åŒ–æµ‹è¯•å·¥å…·

**æŠ€æœ¯æ ˆ:**
- crypto-js: ^4.x
- jsencrypt: ^3.x
- axios: ^1.x

## ğŸ¤ è´¡çŒ®

æ¬¢è¿æäº¤ Issue å’Œ Pull Requestï¼

## ğŸ“„ è®¸å¯

æœ¬åŠŸèƒ½éµå¾ªé¡¹ç›®ä¸»è®¸å¯åè®®ã€‚

## ğŸ”— ç›¸å…³é“¾æ¥

- [crypto-js æ–‡æ¡£](https://cryptojs.gitbook.io/docs/)
- [jsencrypt æ–‡æ¡£](https://github.com/travist/jsencrypt)
- [AES åŠ å¯†æ ‡å‡†](https://en.wikipedia.org/wiki/Advanced_Encryption_Standard)
- [RSA åŠ å¯†æ ‡å‡†](https://en.wikipedia.org/wiki/RSA_(cryptosystem))

---

**éœ€è¦å¸®åŠ©ï¼Ÿ** æŸ¥çœ‹ [å¿«é€Ÿå¼€å§‹æŒ‡å—](./ENCRYPTION_QUICK_START.md) æˆ–è®¿é—® `/crypto` é¡µé¢è¿›è¡Œæµ‹è¯•ï¼
