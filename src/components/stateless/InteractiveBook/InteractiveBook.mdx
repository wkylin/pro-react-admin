---
title: InteractiveBook
---

import { Meta, Canvas, Story, ArgTypes, Controls } from '@storybook/addon-docs/blocks'
import * as InteractiveBookStories from './InteractiveBook.stories'

<Meta of={InteractiveBookStories} />

# InteractiveBook

3D 交互式书籍组件，支持翻页动画、键盘导航和自定义内容。提供 JSX 内容、图片和 PDF 三种渲染模式。

## 组件特性

- 🎨 3D 翻页动画效果（基于 Framer Motion）
- ⌨️ 完整的键盘导航支持（箭头键、Escape、Home、End）
- 📖 双面内容显示（正面内容 + 背面内容）
- 🌊 页角海浪卷起翻页提示（可配置隐藏）
- 🖱️ 拖拽翻页 & 点击翻页（速度感知阈值）
- 🎯 空状态处理
- 🔄 页面变化回调
- 📱 响应式设计
- 🖼️ 图片模式（逐页图片渲染，智能懒加载）
- 📄 PDF 模式（react-pdf 渲染，本地 Worker，不依赖 CDN）
- 🔧 可配置导航栏和页角翻页热区

## 组件预览

<Canvas>
  <Story of={InteractiveBookStories.Default} />
</Canvas>

## 页角翻页提示

鼠标悬停在页面的右下角或左下角时，页角会出现海浪卷起的动画效果，提示用户可以点击翻页。

<Canvas>
  <Story of={InteractiveBookStories.CornerCurlHint} />
</Canvas>

## 少量页面

当翻到最后一页（结束页）时，拖动手势自动禁用，鼠标恢复为普通箭头光标。

<Canvas>
  <Story of={InteractiveBookStories.FewPages} />
</Canvas>

## 图片模式

传入 `pageImages` 数组后，书页内容改为逐页渲染图片。仅预加载当前页 ±2 范围内的图片，支持几百页不卡顿。

<Canvas>
  <Story of={InteractiveBookStories.ImageBook} />
</Canvas>

## PDF 模式

传入 `pdfUrl` 后，使用 react-pdf 渲染 PDF 文件。本地 Worker，不依赖 CDN。每两页 PDF 组成一个书页（正面 + 背面）。

<Canvas>
  <Story of={InteractiveBookStories.PdfBook} />
</Canvas>

## 隐藏导航栏

设置 `showNavigation={false}` 可隐藏底部导航栏，仅保留拖拽、页角点击和键盘翻页方式。

<Canvas>
  <Story of={InteractiveBookStories.HideNavigation} />
</Canvas>

## 隐藏页角翻页热区

设置 `showCornerFlip={false}` 可隐藏页角海浪翻页热区，仅保留拖拽、导航栏和键盘翻页方式。

<Canvas>
  <Story of={InteractiveBookStories.HideCornerFlip} />
</Canvas>

## 极简模式

同时隐藏导航栏和页角翻页热区，仅保留拖拽和键盘翻页，适合嵌入式场景。

<Canvas>
  <Story of={InteractiveBookStories.MinimalMode} />
</Canvas>

## Props（可调参数）

<ArgTypes />

<Controls />

## 渲染模式优先级

组件支持三种渲染模式，优先级从高到低：

| 优先级 | 模式     | 触发条件         | 说明                                     |
| ------ | -------- | ---------------- | ---------------------------------------- |
| 1      | PDF 模式 | 传入 `pdfUrl`    | 使用 react-pdf 渲染 PDF 文件             |
| 2      | 图片模式 | 传入 `pageImages`| 逐页加载图片，智能懒加载当前页 ±2 范围   |
| 3      | JSX 模式 | 传入 `pages`     | 自定义 React 内容，支持正面/背面         |

## 基本使用

### JSX 模式（默认）

```tsx
import InteractiveBook from '@stateless/InteractiveBook'

const pages = [
  {
    pageNumber: 1,
    title: '第一章：简介',
    content: <div>这是第一页的内容</div>,
    backContent: <div>这是第一页的背面内容</div>,
  },
  // ... 更多页面
]

function Example() {
  return (
    <InteractiveBook
      coverImage="https://example.com/cover.jpg"
      bookTitle="我的书籍"
      bookAuthor="作者名"
      pages={pages}
      width={350}
      height={500}
    />
  )
}
```

### 图片模式

```tsx
import InteractiveBook from '@stateless/InteractiveBook'

// 每张图片对应书的一面，两张组成一个书页（正面 + 背面）
const pageImages = [
  '/images/page1.jpg',
  '/images/page2.jpg',
  '/images/page3.jpg',
  // ... 更多图片
]

function Example() {
  return (
    <InteractiveBook
      coverImage="https://example.com/cover.jpg"
      bookTitle="图片翻书"
      pages={[]}
      pageImages={pageImages}
      width={350}
      height={500}
    />
  )
}
```

### PDF 模式

```tsx
import InteractiveBook from '@stateless/InteractiveBook'

function Example() {
  return (
    <InteractiveBook
      coverImage="https://example.com/cover.jpg"
      bookTitle="PDF 文档"
      pages={[]}
      pdfUrl="/assets/pdf/sample.pdf"
      width={350}
      height={500}
    />
  )
}
```

### 带回调的使用

```tsx
import InteractiveBook from '@stateless/InteractiveBook'

function Example() {
  const handlePageChange = (pageIndex: number) => {
    console.log('当前页面索引:', pageIndex)
  }

  return (
    <InteractiveBook
      coverImage="https://example.com/cover.jpg"
      bookTitle="我的书籍"
      bookAuthor="作者名"
      pages={pages}
      onPageChange={handlePageChange}
      enableKeyboard={true}
    />
  )
}
```

### 配置导航和页角翻页

```tsx
import InteractiveBook from '@stateless/InteractiveBook'

function Example() {
  return (
    <InteractiveBook
      coverImage="https://example.com/cover.jpg"
      bookTitle="极简模式"
      pages={pages}
      showNavigation={false}    // 隐藏底部导航栏
      showCornerFlip={false}    // 隐藏页角翻页热区
      enableKeyboard={true}     // 保留键盘翻页
    />
  )
}
```

## 页面数据结构

```tsx
interface BookPage {
  title?: string
  content: React.ReactNode
  backContent?: React.ReactNode
  pageNumber: number
}
```

## 键盘导航

组件支持以下键盘操作（需设置 `enableKeyboard={true}`）：

| 快捷键     | 功能       |
| ---------- | ---------- |
| `←`        | 向前翻页   |
| `→`        | 向后翻页   |
| `Escape`   | 关闭书籍   |
| `Home`     | 回到封面   |
| `End`      | 跳到最后页 |

## 交互方式

组件支持多种翻页交互方式：

| 交互方式      | 说明                                                | 可配置     |
| ------------- | --------------------------------------------------- | ---------- |
| 拖拽翻页      | 在页面上按住并左右拖拽，超过阈值后松手翻页          | 始终可用   |
| 页角点击      | 鼠标悬停在页面右下角/左下角，出现卷起效果后点击翻页 | `showCornerFlip` |
| 导航栏按钮    | 底部导航栏的前后翻页按钮                            | `showNavigation` |
| 键盘快捷键    | 方向键、Home、End、Escape                           | `enableKeyboard` |
| 封面点击/拖拽 | 点击或向左拖拽封面打开书籍                          | 始终可用   |

> **注意**：最后一页（结束页）禁用拖拽，鼠标光标恢复为普通箭头。

## 高级用法

### 自定义样式

组件使用 CSS Modules（Less），可以通过 `className` 传入自定义样式：

```tsx
<InteractiveBook
  className="my-custom-book"
  coverImage="/cover.jpg"
  pages={pages}
/>
```

### 响应式设计

组件支持响应式尺寸设置：

```tsx
<InteractiveBook
  width="100%"
  height="auto"
  // 其他属性...
/>
```

## 注意事项

- 确保 `pages` 数组中的每个页面都有唯一的 `pageNumber`
- 封面图片建议使用合适的尺寸以获得最佳显示效果
- 组件内部使用 Framer Motion 进行动画，性能已优化
- 空页面数组会显示友好的空状态提示
- PDF 模式使用本地 Worker（`pdfjs-dist/build/pdf.worker.min.mjs`），无需外部 CDN
- 图片模式仅预加载当前页 ±2 范围的图片，适合大量页面场景
- `pdfUrl` 优先级高于 `pageImages`，`pageImages` 优先级高于 `pages`
