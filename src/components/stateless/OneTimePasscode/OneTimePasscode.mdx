---
title: OneTimePasscode
---

# OneTimePasscode

用于输入一次性验证码（OTP / PIN）的轻量输入组件，支持受控/非受控用法、IME 兼容、粘贴、以及三种视觉变体（`modern` / `compact` / `classic`）。组件使用 CSS Modules（`index.module.less`），并从项目主题中读取主色用于焦点样式。

## 基本使用

### 受控用法

```jsx live
import React, { useState } from 'react'
import OneTimePasscode from './OneTimePasscode'

function Example() {
  const [code, setCode] = useState('')
  return <OneTimePasscode length={6} value={code} onChange={setCode} autoFocus variant="modern" />
}

export default Example
```

### 非受控用法

```jsx live
import OneTimePasscode from './OneTimePasscode'

function Example() {
  return <OneTimePasscode length={4} onChange={(v) => console.log('value', v)} />
}

export default Example
```

## 属性（Props）

<table>
  <thead>
    <tr>
      <th>Property</th>
      <th>Type</th>
      <th>Default</th>
      <th>Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>length</code></td>
      <td><code>number</code></td>
      <td><code>6</code></td>
      <td>验证码的长度，即输入框的数量。必须大于 0。</td>
    </tr>
    <tr>
      <td><code>value</code></td>
      <td><code>string?</code></td>
      <td>-</td>
      <td>受控模式下的值。如果提供此 prop，组件将变为受控组件，输入值由外部控制。</td>
    </tr>
    <tr>
      <td><code>onChange</code></td>
      <td><code>(value: string) => void?</code></td>
      <td>-</td>
      <td>值变更时的回调函数。每次输入变更时都会调用，传入当前完整的验证码字符串。</td>
    </tr>
    <tr>
      <td><code>autoFocus</code></td>
      <td><code>boolean?</code></td>
      <td><code>false</code></td>
      <td>是否自动聚焦到第一个输入框。适用于页面加载后立即输入的场景。</td>
    </tr>
    <tr>
      <td><code>disabled</code></td>
      <td><code>boolean?</code></td>
      <td><code>false</code></td>
      <td>是否禁用所有输入框。禁用状态下无法输入，但仍可显示值。</td>
    </tr>
    <tr>
      <td><code>className</code></td>
      <td><code>string?</code></td>
      <td>-</td>
      <td>外层容器的 CSS 类名，用于自定义样式覆盖。</td>
    </tr>
    <tr>
      <td><code>inputClassName</code></td>
      <td><code>string?</code></td>
      <td>-</td>
      <td>每个输入框的 CSS 类名，用于自定义单个输入框样式。</td>
    </tr>
    <tr>
      <td><code>id</code></td>
      <td><code>string?</code></td>
      <td>-</td>
      <td>组件根元素的 id 属性，用于表单关联或测试。</td>
    </tr>
    <tr>
      <td><code>name</code></td>
      <td><code>string?</code></td>
      <td>-</td>
      <td>表单 name 属性，用于表单提交时的字段名。</td>
    </tr>
    <tr>
      <td><code>validateChar</code></td>
      <td><code>(char: string) => boolean?</code></td>
      <td>-</td>
      <td>字符验证函数。用于限制输入的字符类型。例如，<code>(ch) => /\d/.test(ch)</code> 只允许数字；<code>(ch) => ch === '' || /\d/.test(ch)</code> 允许数字和删除（空字符）。如果未提供，默认允许任何单字符（包括空字符）。</td>
    </tr>
    <tr>
      <td><code>variant</code></td>
      <td><code>'modern' | 'compact' | 'classic'?</code></td>
      <td><code>'modern'</code></td>
      <td>视觉变体。<code>modern</code> 为现代样式（渐变背景、阴影）；<code>compact</code> 为紧凑样式（小尺寸、无阴影）；<code>classic</code> 为经典样式（简单边框、无渐变）。</td>
    </tr>
  </tbody>
</table>

说明：`validateChar` 默认允许任何单字符（并允许空字符以支持删除）。你可以传入例如 `(ch) => /\d/.test(ch)` 来限制为数字。

## 示例：只允许数字

```jsx
<OneTimePasscode length={6} validateChar={(ch) => ch === '' || /\d/.test(ch)} />
```

## 自定义样式与主题

- 组件默认使用 CSS Module `index.module.less`。如果 Storybook 或测试环境无法加载 CSS Module，组件内部会提供简易的内联样式回退以保证可视性。
- 你可以通过 `className` 覆盖外层容器，或通过 `inputClassName` 覆盖每个输入框的样式。
- 组件会尝试通过项目的 `useProThemeContext()` 读取主题主色并设置 CSS 变量 `--otp-primary` / `--otp-primary-rgb`，以用在焦点环上；如果主题上下文不可用，会使用默认蓝色。

## 边界与行为说明

- 组件支持 IME（合成输入），在合成结束时会正确写入字符到当前格子。
- 支持粘贴：你可以在任一格粘贴一串字符，组件会按位填充并聚焦到粘贴段最后一位。
- Backspace：在空格上按 Backspace 会聚焦到前一格并清空它。

## 开发和调试提示

- 如果在 Storybook 中看不到样式，先确认 `.storybook/main.ts` 已配置 Less 与 CSS Modules 的 loader；也可以在 stories 中临时使用 wrapper（`centeredWrapper`）来强制应用模块化样式。

```jsx
import styles from './index.module.less'
;<div className={styles.centeredWrapper}>
  <OneTimePasscode length={6} />
</div>
```

## 联系与贡献

如有额外需求（例如增加粘贴验证、支持 OTP 自动提交等），欢迎在仓库提交 issue 或 PR。
